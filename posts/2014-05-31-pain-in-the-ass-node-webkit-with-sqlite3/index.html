<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>在node-webkit中使用sqlite3 - VoidMain&#39;s Blog</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
	<meta property="og:title" content="在node-webkit中使用sqlite3" />
<meta property="og:description" content="这两天在调研使用node-webkit开发Mac应用并且提交到Mac App Store的可能性。这类客户端应用有非常通用的一点就是需要一个本地数据存储功能。根据node-webkit的官方wiki，我觉得最适合的就是所谓的Web SQL Database了，同时文档中也说是使用sqlite3来实现的。因此就需要实现sqlite3与node-webkit的整合。
为了测试，我直接clone了一个windows版的demo。最开始我的尝试是使用node-webkit 0.9.2版（使用最新版的目的是为了保证node-webkit没有使用一些过时的或者private的api导致MAS审核悲剧）。首先我用npm install sqlite3安装了sqlite3 for node，结束之后运行nw node-webkit-sqlite3-windows-demo，结果提示error：
Error: Cannot find module &#39;/Users/voidmain/WorkSpace/NodeJS/node-webkit-sqlite3-windows-demo/node_modules/sqlite3/lib/binding/node-v11-darwin-ia32/node_sqlite3.node&#39;  如果直接google这个错误会有人说明使用nw-gyp rebuild --target=&lt;node-webkit-version&gt; --arch=ia32来rebuild一下（如果没有安装nw-gyp的话需要先npm install一下），但是使用node-webkit 0.9.2的话，编译不会通过，会提示有error，于是继续google，终于在sqlite3项目的issue 265中看到了这个：
看来是死胡同了，无奈只能使用更早版本的node-webkit，所以我换成了node-webkit 0.8.6版，然后再次用nw-gyp编译，还是出错，错误是Undefined variable module_name in binding.gyp while trying to load binding.gyp，继续google，最后又在wiki中找到了解答：Build native modules with nw gyp，关键的一段是：
 For some packages you may need to use node-pre-gyp (e.g. when you get the error &ldquo;Undefined variable module_name in binding.gyp while trying to load binding.gyp&rdquo;), which supports building for both node." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://blog.voidmain.guru/posts/2014-05-31-pain-in-the-ass-node-webkit-with-sqlite3/" />
<meta property="article:published_time" content="2014-05-31T15:38:27+00:00" />
<meta property="article:modified_time" content="2014-05-31T15:38:27+00:00" />

	<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="在node-webkit中使用sqlite3"/>
<meta name="twitter:description" content="这两天在调研使用node-webkit开发Mac应用并且提交到Mac App Store的可能性。这类客户端应用有非常通用的一点就是需要一个本地数据存储功能。根据node-webkit的官方wiki，我觉得最适合的就是所谓的Web SQL Database了，同时文档中也说是使用sqlite3来实现的。因此就需要实现sqlite3与node-webkit的整合。
为了测试，我直接clone了一个windows版的demo。最开始我的尝试是使用node-webkit 0.9.2版（使用最新版的目的是为了保证node-webkit没有使用一些过时的或者private的api导致MAS审核悲剧）。首先我用npm install sqlite3安装了sqlite3 for node，结束之后运行nw node-webkit-sqlite3-windows-demo，结果提示error：
Error: Cannot find module &#39;/Users/voidmain/WorkSpace/NodeJS/node-webkit-sqlite3-windows-demo/node_modules/sqlite3/lib/binding/node-v11-darwin-ia32/node_sqlite3.node&#39;  如果直接google这个错误会有人说明使用nw-gyp rebuild --target=&lt;node-webkit-version&gt; --arch=ia32来rebuild一下（如果没有安装nw-gyp的话需要先npm install一下），但是使用node-webkit 0.9.2的话，编译不会通过，会提示有error，于是继续google，终于在sqlite3项目的issue 265中看到了这个：
看来是死胡同了，无奈只能使用更早版本的node-webkit，所以我换成了node-webkit 0.8.6版，然后再次用nw-gyp编译，还是出错，错误是Undefined variable module_name in binding.gyp while trying to load binding.gyp，继续google，最后又在wiki中找到了解答：Build native modules with nw gyp，关键的一段是：
 For some packages you may need to use node-pre-gyp (e.g. when you get the error &ldquo;Undefined variable module_name in binding.gyp while trying to load binding.gyp&rdquo;), which supports building for both node."/>

	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">
	<link rel="stylesheet" href="/css/style.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container">
		<div class="logo">
			<a class="logo__link" href="/" title="VoidMain&#39;s Blog" rel="home">
				<div class="logo__title">VoidMain&#39;s Blog</div>
				<div class="logo__tagline">Blogs from VoidMain</div>
			</a>
		</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">在node-webkit中使用sqlite3</h1>
			<div class="post__meta meta">
<div class="meta__item-datetime meta__item">
	<svg class="meta__icon icon icon-time" width="16" height="14" viewBox="0 0 30 28"><path d="M15 0C7 0 1 6 1 14s6 14 14 14 14-6 14-14S23 0 15 0zm0 25C9 25 4 20 4 14S9 3 15 3s11 5 11 11-5 11-11 11zm1-18h-2v8.4l6.8 4.4L22 18l-6-3.8V7z"/></svg>
	<time class="meta__text" datetime="2014-05-31T15:38:27">2014-05-31</time>
</div>

<div class="meta__item-categories meta__item">
	<svg class="meta__icon icon icon-category" width="16" height="16" viewBox="0 0 16 16"><path d="m7 2l1 2h8v11h-16v-13z"/></svg>
	<span class="meta__text"><a class="meta__link" href="/categories/node-webkit" rel="category">node-webkit</a>, <a class="meta__link" href="/categories/sqlite3" rel="category">sqlite3</a></span>
</div>
</div>
		</header>
<div class="post__toc toc">
	<div class="toc__title">Page content</div>
	<div class="toc__menu">
		
	</div>
</div>
<div class="content post__content clearfix">
			<p>这两天在调研使用node-webkit开发Mac应用并且提交到Mac App Store的可能性。这类客户端应用有非常通用的一点就是需要一个本地数据存储功能。根据node-webkit的<a href="https://github.com/rogerwang/node-webkit/wiki/Save-persistent-data-in-app">官方wiki</a>，我觉得最适合的就是所谓的Web SQL Database了，同时文档中也说是使用sqlite3来实现的。因此就需要实现sqlite3与node-webkit的整合。</p>

<p>为了测试，我直接clone了<a href="https://github.com/zycbob/node-webkit-sqlite3-windows-demo">一个windows版的demo</a>。最开始我的尝试是使用node-webkit 0.9.2版（使用最新版的目的是为了保证node-webkit没有使用一些过时的或者private的api导致MAS审核悲剧）。首先我用<code>npm install sqlite3</code>安装了sqlite3 for node，结束之后运行<code>nw node-webkit-sqlite3-windows-demo</code>，结果提示error：</p>

<pre><code>Error: Cannot find module '/Users/voidmain/WorkSpace/NodeJS/node-webkit-sqlite3-windows-demo/node_modules/sqlite3/lib/binding/node-v11-darwin-ia32/node_sqlite3.node'
</code></pre>

<p>如果直接google这个错误会有人说明使用<code>nw-gyp rebuild --target=&lt;node-webkit-version&gt; --arch=ia32</code>来rebuild一下（如果没有安装nw-gyp的话需要先npm install一下），但是使用node-webkit 0.9.2的话，编译不会通过，会提示有error，于是继续google，终于在sqlite3项目的<a href="https://github.com/mapbox/node-sqlite3/issues/265">issue 265</a>中看到了这个：</p>

<p><img src="/assets/node-webkit-0_9_2-sqlite3-error.png" alt="node-webkit 0.9.2 with sqlite3" /></p>

<p>看来是死胡同了，无奈只能使用更早版本的node-webkit，所以我换成了<a href="http://dl.node-webkit.org/v0.8.6/node-webkit-v0.8.6-osx-ia32.zip">node-webkit 0.8.6版</a>，然后再次用nw-gyp编译，还是出错，错误是<code>Undefined variable module_name in binding.gyp while trying to load binding.gyp</code>，继续google，最后又在wiki中找到了解答：<a href="https://github.com/rogerwang/node-webkit/wiki/Build-native-modules-with-nw-gyp">Build native modules with nw gyp</a>，关键的一段是：</p>

<blockquote>
<p>For some packages you may need to use node-pre-gyp (e.g. when you get the error &ldquo;Undefined variable module_name in binding.gyp while trying to load binding.gyp&rdquo;), which supports building for both node.js and node-webkit by using either node-gyp or nw-gyp.</p>

<pre><code class="language-bash">$ npm install node-pre-gyp
$ node-pre-gyp build --runtime=node-webkit --target=0.3.3
</code></pre>
</blockquote>

<p>至此，再次编译就能通过，而且运行无压力了。但是仍然有两点顾虑，首先0.8.6版本的node-webkit是否对Mac App Store友好，其次，在sandboxing环境下数据库文件存储的位置问题。为了解决这两个疑惑可能只能通过一下小应用来测试一下了。有后续进展我会继续更新blog。</p>

		</div>
		
	</article>
</main>

<div class="authorbox clearfix">
	<div class="authorbox__header">
		<span class="authorbox__name">About Void Main</span>
	</div>
	<div class="authorbox__description">
		A passionate coding bitch.
	</div>
</div>

<nav class="post-nav flex">
	<div class="post-nav__item post-nav__item--prev">
		<a class="post-nav__link" href="/posts/2014-05-19-fuck-cfprefsd/" rel="prev"><span class="post-nav__caption">«&thinsp;Previous</span><p class="post-nav__post-title">NSUserDefaults无法保存？</p></a>
	</div>
	<div class="post-nav__item post-nav__item--next">
		<a class="post-nav__link" href="/posts/2014-06-04-learning-swift-1/" rel="next"><span class="post-nav__caption">Next&thinsp;»</span><p class="post-nav__post-title">使用Swift(1)</p></a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2019 Void Main.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
	</div>
<script async defer src="/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>
</body>
</html>